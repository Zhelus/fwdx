<script setup>
import { ref } from 'vue';
import FormTextInputItem from '@/components/report_form/FormTextInputItem.vue';
import FormCheckboxItem from '@/components/report_form/FormCheckboxItem.vue';
import FormActionButton from '@/components/report_form/FormActionButton.vue';
import { useRouter } from 'vue-router';

const oligoName = ref('');
const oligoString = ref('');
const isOligoNegative = ref(false);
const confirmationText = ref('');
const props = defineProps(['formTitle', 'showFrequency', 'isEditReport']);
const router = useRouter();

function cancelClicked() {
  console.log("Clicked cancel button");
  router.push("/oligos");
}

function addOligoClicked() {
  console.log("Add Oligo clicked with data:", {
    oligoName: oligoName.value,
    oligoString: oligoString.value,
    isOligoNegative: isOligoNegative.value,
    confirmationText: confirmationText.value,
  });
}

function handleFileUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      oligoString.value = e.target.result; // Set the file content to the input field
    };
    reader.onerror = () => {
      console.error("Failed to read the file.");
    };
    reader.readAsText(file); // Read file content as text
  }
}
</script>

<template>
  <div class="add-oligo-form-container">
    <h1 class="form-header">{{ formTitle }}</h1>
    <!-- Oligo Name -->
    <div class="oligo-name">
      <FormTextInputItem 
        v-model="oligoName" 
        section-header="Oligo Name" 
        placeholder="Enter Oligo Name" 
      />
    </div>

    <!-- Oligo String and Upload File Button -->
    <div class="oligo-string-upload">
      <FormTextInputItem 
        v-model="oligoString" 
        section-header="Oligo Strings" 
        placeholder="Enter here or Upload from text file" 
      />
      <!-- Hidden File Input -->
      <input 
        type="file" 
        accept=".txt" 
        class="hidden-file-input" 
        @change="handleFileUpload" 
        id="file-upload"
      />
      <!-- Styled Choose File Button -->
      <label for="file-upload">
        <FormActionButton button-text="Choose File" button-class="upload" />
      </label>
    </div>

    <!-- Oligo Negative Checkbox -->
    <FormCheckboxItem 
      :options-list="[{ name: 'Oligo Negative?', value: 'negative' }]" 
      v-model="isOligoNegative" 
    />

    <!-- Confirmation Text Input -->
    <FormTextInputItem 
      v-model="confirmationText" 
      section-header="Type 'YES' to confirm the above information is correct" 
      placeholder="Type 'YES' here" 
    />

    <!-- Action Buttons -->
    <div class="form-button-container">
      <FormActionButton 
        button-text="Cancel" 
        button-class="cancel" 
        @click="cancelClicked" 
      />
      <FormActionButton 
        button-text="Add Oligo" 
        button-class="submit" 
        @click="addOligoClicked" 
      />
    </div>
  </div>
</template>

<style scoped>
.add-oligo-form-container {
  display: flex;
  flex-direction: column;
  background-color: #ffffff;
  border-radius: 10px;
  padding: 30px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  max-width: 800px;
  margin: 0 auto;
}

.form-header {
  color: var(--fwdx-blue);
  font-weight: 700;
  font-size: 26px;
  margin-bottom: 20px;
}

.oligo-name {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.oligo-string-upload {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.hidden-file-input {
  display: none; /* Hide the native file input */
}

.form-button-container {
  display: flex;
  gap: 20px;
  margin-top: 20px;
}

button {
  padding: 12px 20px;
  font-size: 16px;
}
</style>
